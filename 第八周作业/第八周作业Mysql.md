## 题目 01- 请你说一说 MySQL 的锁机制

要求：

*   按照锁的粒度，锁的功能来分析

    锁粒度分：

    &#x9;1.全局锁：通过mysql服务层实现的，锁整个database.

    &#x9;2.表级锁：通过mysql服务层实现的，锁某张表.

    &#x9;3.行级锁：通过mysql的存储引擎，innodb实现的，锁表中的某行数据



    锁功能分：

    &#x9;1.共享锁，可以理解为读锁。一个事务对数据加了读锁，另外的事务仍然可以加读锁。

    &#x9;2.排他锁，可以理解为写锁。一个事务对数据加了写锁，其他事务无法加写锁和读锁。


*   什么是死锁，为什么会发生，如何排查？

    死锁：指两个或者两个以上的进程在执行过程中，因为争夺资源而相互等待的现象。

    原因：两个(或以上)的Session加锁的顺序不一致。

    如何排查：

    1.show engine innodb status\G

    2.查看错误日志


*   行锁是通过加在什么上完成的锁定？

    索引。所以，只有通过索引检索的数据才能使用行锁，否则innodb将使用表锁。


*   详细说说这条 SQL 的锁定情况：`delete from tt where uid = 666`;

    RC隔离级别

    1.uid是主键索引：在uid=666上加了写锁

    2.uid是非主键唯一索引：在uid=666上加了写锁，同时在该条数据对一个的主键索引上加写锁

    3.uid是的非唯一索引：在uid=666查询的多条数据都加写锁，同时多条数据对应的主键上也加写锁

    4.uid无索引：会进行聚簇索引全扫描，聚簇索引上每天数据都会加写锁



    RR隔离级别

    1.uid是主键索引：在uid=666上加了写锁

    2.uid是非主键唯一索引：在uid=666上加了写锁，同时在该条数据对一个的主键索引上加写锁

    3.uid是的非唯一索引：首先，通过id索引 定位到第一条满足查询条件的记录，加记录上的写锁，加GAP上的间隙锁，然后加主键聚簇索引上的记 录写锁，然后返回；然后读取下一条，重复进行。直至进行到第一条不满足条件的记录\[11,f]，此时，不 需要加记录写锁，但是仍旧需要加间隙锁，最后返回结束。

    4.uid无索引：如果进行全表扫描的当前读，那么会锁上表中的所有记录，同时会锁上聚簇索 引内的所有间隙，杜绝所有的并发 更新/删除/插入 操作



## 题目 02- 请你说一说 MySQL 的 SQL 优化

1.调优表结构

&#x9;合理设计表结构，适当拆分大表等

2.调优SQL语句

&#x9;编写更加规范合理的sql,课通过explain进行sql执行过程分析

3.调优索引

&#x9;根据索引创建原则进行索引优化

4.调优mysql配置

&#x9;包括mysql客户端的连接池等连接属性配置、mysql服务端的连接配置和缓存配置等。

5.调优硬件

&#x9;如增加服务器CPU核数、内存等，增加网络带宽





&#x9;
